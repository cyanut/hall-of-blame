{% macro render_hand(label, hand) %}
<p><b>N: {{label}}</b></p>
    {% for h in hand %}
    <p><b>{{h[0]}}</b> {{h[1]}}
    {% endfor %}
{% endmacro %}

{% macro seat_row(seats) %}
    {% for seat in seats %}
    <td><b>{{seat}}</b></td>
    {% endfor %}
{% endmacro %}

{% with seats = "NESW" %}
<div id='board_{{board_num}}'>
    <table>
        <tr>
<td class='deal' id="deal_{{board_num}}">
<table>
    <tr>
        <td>
            <p>Vul: {{deal.vul}}</p>
            <p>Result: {{board.result}}</p>
            <p>Score: {{board.scorens}}</p>
            <p>IMP: </p>
        </td>
        <td>
            {{ render_hand(deal.labelnorth, deal.all.N)}}
        </td>
        <td>
            <p><b>Par</b></p>
            <p>
                {% for par in analysis.par.contracts %}
                {{par}} <br />
                {% endfor %}
                Par Score: {{analysis.par.score}}
            </p>
        </td>
    </tr>
    <tr>
        <td>
            {{ render_hand(deal.labelwest, deal.all.W)}}
        </td>
        <td>
            Board {{board_num}}
        </td>
        <td>
            {{ render_hand(deal.labeleast, deal.all.E)}}
        </td>
    </tr>
    <tr>
        <td>
            Bidding
            <table>
                <tr>
                    {{ seat_row(seats) }}
                </tr>
                <tr>
                {% for i in range(deal.dealer_num)%}
                    <td></td>
                {% endfor %}
                {% for bid in bids %}
                <td class="{% if bid.alert == "Y"%}bid_alert{%endif%} {% if bid.explain%}bid_explain{%endif%}" title='{{bid.explain}}'>{{bid.call}}</td>
                {% if (loop.index + deal.dealer_num) % 4 == 0 %}
                </tr>
                <tr>
                {% endif%}
                {% endfor %}
            </table>
        </td>
        <td>
            {{ render_hand(deal.labelsouth, deal.all.S) }}
        </td>
        <td>
            trick matrix
            <table>
                <tr>
                    <td></td>
                    {% for suit in ["S","H","D","C","NT"] %}
                    <td>{{suit}}</td>
                    {% endfor %}
                </tr>
                {% for res in analysis.par.dd_table %}
                <tr>
                <td>{{res[0]}}</td>
                {% for trick in res[1] %}
                <td>{{trick}}</td>
                {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </td>
    </tr>
</table>
</td>

<td id="play_seq_{{board_num}}">
    <table>
        <tr>
        </tr>
        {% for round in analysis.play_anotated%}
        <tr>
            {% for card in round %}
            <td class="{%if card[3]%}lead_card{%endif%}{%if card[2]>0%} good_card{%endif%}{%if card[2]>0%} bad_card{%endif%}">
                    {{card[0]}}<sub>{{"{:+d}".format(card[2])}}</sub>
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</td>

<td id="other_table_{{board_num}}">
    other tables
</span>
</td>
    </tr>
    </table>
    
</div>
{% endwith %}
